# UI整理: ツールバー・Canvas描画色・対称ガイド

## Context

Webデモアプリ（apps/web）のUIを整理する。ツールバーのアイコンをモノトーンに変更しコンパクト化、Canvas描画色の定数化、対称ガイドの線の修正を行う。

## 変更対象ファイル

| ファイル | 変更内容 |
|---|---|
| [config.ts](apps/web/src/config.ts) | UI色定数の追加 |
| [Toolbar.tsx](apps/web/src/components/Toolbar.tsx) | アイコン置換・コンパクト化・Reset削除 |
| [App.tsx](apps/web/src/App.tsx) | `onReset` prop削除 |
| [PaintCanvas.tsx](apps/web/src/components/PaintCanvas.tsx) | ハードコード色を定数に置換 |
| [SymmetryOverlay.tsx](apps/web/src/components/SymmetryOverlay.tsx) | ガイド色定数化・線幅1px・Kaleido線種修正 |

---

## Phase 1: API設計・ドキュメント

今回はライブラリパッケージのAPI変更はなく、apps/web内のUI変更のみ。ドキュメント更新は不要。

### 1-1. アイコンライブラリ: lucide-react

**選定理由:**
- Tree-shakeable（未使用アイコンはバンドルに含まれない）
- モノトーン/アウトラインスタイルで統一感あり
- React 19対応、アクティブにメンテ中
- 1400+アイコン、ペイントツール向けアイコン（Pen, Eraser, Hand等）が揃っている

### 1-2. アイコンマッピング

| ツール | 現在 | Lucide |
|---|---|---|
| pen | ✏️ | `Pen` |
| eraser | 🧹 | `Eraser` |
| scroll | ✋ | `Hand` |
| rotate | 🔄 | `RotateCw` |
| zoom | 🔍 | `ZoomIn` |
| offset | ↔ | `ArrowLeftRight` |
| undo | ↩ | `Undo2` |
| redo | ↪ | `Redo2` |

- アイコンサイズ: `size={16}`
- テキストラベルは削除し、アイコンのみ表示（`title` と `aria-label` でアクセシビリティ確保）

### 1-3. UI色定数（config.ts に追加）

```ts
// ── UI Colors ───────────────────────────────────
export const UI_BACKGROUND_COLOR = "#f0f0f0";
export const UI_LAYER_BORDER_COLOR = "#444";
export const UI_SYMMETRY_GUIDE_COLOR = "rgba(100, 100, 255, 0.6)";
```

### 1-4. 対称ガイド線の仕様

| モード | 線種 | 理由 |
|---|---|---|
| axial | 点線 | ミラー反転軸 |
| radial | **実線** | 回転分割軸のみ（反転なし） |
| kaleidoscope | 偶数index=**実線**（分割軸）、奇数index=**点線**（ミラー軸） | expand.tsの行列生成順に対応 |

線幅: 2px → **1px**

---

## Phase 2: 利用イメージ

### ツールバー

```tsx
// Toolbar.tsx - アイコンのみのコンパクトなボタン
<button title="Pen" aria-label="Pen">
  <Pen size={16} />
</button>
```

コンテナスタイル変更:
- `padding: 8` → `padding: 2`
- `gap: 8` → `gap: 2`
- `boxShadow` → 削除
- `borderRadius: 8` → `borderRadius: 4`
- ボタン: `padding: "8px 16px"` → `padding: "6px"`

### config.ts からの色の利用

```tsx
// PaintCanvas.tsx
import { UI_BACKGROUND_COLOR, UI_LAYER_BORDER_COLOR } from "../config";
ctx.fillStyle = UI_BACKGROUND_COLOR;   // "#f0f0f0"
ctx.strokeStyle = UI_LAYER_BORDER_COLOR; // "#444"

// SymmetryOverlay.tsx
import { UI_SYMMETRY_GUIDE_COLOR } from "../config";
const GUIDE_COLOR = UI_SYMMETRY_GUIDE_COLOR;
```

### Kaleido ガイドの描画ロジック

```tsx
if (config.mode === "axial") {
  ctx.setLineDash(GUIDE_DASH);
  drawAxisLine(ctx, originScreen, config.angle, width, height);
} else if (config.mode === "radial") {
  ctx.setLineDash([]);  // 実線
  for (let i = 0; i < config.divisions; i++) {
    const angle = (Math.PI * 2 * i) / config.divisions + config.angle;
    drawAxisLine(ctx, originScreen, angle, width, height);
  }
} else if (config.mode === "kaleidoscope") {
  const totalLines = config.divisions * 2;
  for (let i = 0; i < totalLines; i++) {
    const angle = (Math.PI * 2 * i) / totalLines + config.angle;
    ctx.setLineDash(i % 2 === 0 ? [] : GUIDE_DASH);  // 偶数=実線、奇数=点線
    drawAxisLine(ctx, originScreen, angle, width, height);
  }
}
ctx.setLineDash([]);
```

---

## Phase 3: 実装手順

### Step 1: lucide-react インストール
```bash
pnpm --filter @headless-paint/web add lucide-react
```

### Step 2: config.ts にUI色定数を追加

### Step 3: Toolbar.tsx の更新
- lucide-react アイコンに置換
- コンテナスタイルのコンパクト化
- Reset ボタンと `onReset` prop の削除
- テキストラベル削除、`aria-label` 追加

### Step 4: App.tsx の更新
- `<Toolbar>` から `onReset={fitToView}` を削除
- `fitToView` 自体は初回マウント時に使用するため残す

### Step 5: PaintCanvas.tsx の更新
- `UI_BACKGROUND_COLOR`, `UI_LAYER_BORDER_COLOR` をインポートして使用

### Step 6: SymmetryOverlay.tsx の更新
- `UI_SYMMETRY_GUIDE_COLOR` をインポートして使用
- `lineWidth` を 2 → 1 に変更
- Kaleido ガイドの線種ロジック修正（分割軸=実線、ミラー軸=点線）
- Radial ガイドを実線に変更

---

## Phase 4: 検証

- `pnpm dev` で開発サーバー起動
- ツールバーのアイコンがモノトーンSVGで表示されること
- ツールバーがコンパクトになり、余白・シャドウがないこと
- Resetボタンが表示されないこと
- 各ツールボタンのクリック・ホバーが正常動作すること
- Canvas背景色・レイヤー境界色が従来と同じ見た目であること
- 対称ガイドの線幅が1pxに変わっていること
- Kaleidoscopeモードで分割軸が実線、ミラー軸が点線であること
- Radialモードですべての線が実線であること
- Axialモードでミラー軸が点線であること
- `pnpm build` が成功すること
